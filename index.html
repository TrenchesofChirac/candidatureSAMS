<?php
$confirmation = '';
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $webhook_url = "https://discord.com/api/webhooks/1407697828720939149/MoGZxxoqoO8Mn1dwsdQCZVGABt3KUIn9fElxdp-2VjDvFh6I9vUc8If_QMmyeHCTau7O";

    function field($name) {
        return htmlspecialchars($_POST[$name] ?? '');
    }

    $nom = field('nom');
    $age = field('age');
    $discord = field('discord');
    $steam = field('steam');
    $departement = field('departement');
    $experience = field('experience');
    $motivations = field('motivations');
    $disponibilites = field('disponibilites');
    $plages = field('plages');
    $scenario1 = field('scenario1');
    $scenario2 = field('scenario2');
    $scenario3 = field('scenario3');
    $scenario4 = field('scenario4');
    $scenario5 = field('scenario5');

    $json_data = json_encode([
        "embeds" => [[
            "title" => "üìã Nouvelle candidature VCMC",
            "color" => 16711680,
            "fields" => [
                ["name" => "üë§ Nom RP", "value" => $nom ?: "Ex : John Doe", "inline" => true],
                ["name" => "üéÇ √Çge", "value" => $age ?: "Ex : 25", "inline" => true],
                ["name" => "üí¨ Discord", "value" => $discord ?: "Ex : JohnDoe#1234", "inline" => false],
                ["name" => "üÜî Steam/Rockstar ID", "value" => $steam ?: "Ex : STEAM_0:1:123456", "inline" => false],
                ["name" => "üè• D√©partement vis√©", "value" => $departement ?: "Ex : Ambulance", "inline" => false],
                ["name" => "üìñ Exp√©rience RP/EMS", "value" => $experience ?: "Ex : 2 ans RP EMS", "inline" => false],
                ["name" => "üî• Motivations", "value" => $motivations ?: "Ex : Aider les joueurs en RP", "inline" => false],
                ["name" => "üìÜ Disponibilit√©s", "value" => $disponibilites ?: "Ex : Lundi-Vendredi", "inline" => true],
                ["name" => "‚è∞ Plages horaires", "value" => $plages ?: "Ex : 18h-22h", "inline" => true],
                ["name" => "üé≠ Sc√©nario 1", "value" => $scenario1 ?: "Ex : Alerter les secours et s√©curiser la zone", "inline" => false],
                ["name" => "üé≠ Sc√©nario 2", "value" => $scenario2 ?: "Ex : Commencer la r√©animation et demander de l‚Äôaide imm√©diatement", "inline" => false],
                ["name" => "üé≠ Sc√©nario 3", "value" => $scenario3 ?: "Ex : S√©curiser la zone et appeler la police/renforts", "inline" => false],
                ["name" => "üé≠ Sc√©nario 4", "value" => $scenario4 ?: "Ex : V√©rifier les signes vitaux et appeler les secours", "inline" => false],
                ["name" => "üé≠ Sc√©nario 5", "value" => $scenario5 ?: "Ex : Administrer l‚Äôadr√©naline si prescrite et alerter les secours", "inline" => false],
            ],
            "footer" => ["text" => "VCMC ‚Äî Formulaire de candidature"],
            "timestamp" => date("c"),
        ]]
    ], JSON_UNESCAPED_SLASHES | JSON_UNESCAPED_UNICODE);

    $ch = curl_init($webhook_url);
    curl_setopt($ch, CURLOPT_HTTPHEADER, ['Content-type: application/json']);
    curl_setopt($ch, CURLOPT_POST, 1);
    curl_setopt($ch, CURLOPT_POSTFIELDS, $json_data);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
    $response = curl_exec($ch);
    curl_close($ch);

    $confirmation = $response !== false ? "‚úÖ Votre candidature a bien √©t√© envoy√©e !" : "‚ùå Une erreur est survenue.";
}
?>

<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>VCMC - Candidature</title>
<style>
body { font-family: Arial, sans-serif; background:#f8f9fa; margin:0; padding:0; }
.container { max-width:800px; margin:50px auto; padding:20px; background:white; border-radius:10px; box-shadow:0 0 15px rgba(0,0,0,0.1); }
h1 { text-align:center; color:#d32f2f; }
label { display:block; margin-top:15px; font-weight:bold; }
input, select, textarea { width:100%; padding:10px; margin-top:5px; border-radius:5px; border:1px solid #ccc; }
button { background:#d32f2f; color:white; padding:12px 20px; border:none; border-radius:5px; cursor:pointer; margin-top:20px; width:100%; font-size:16px; }
button:hover { background:#b71c1c; }
.confirm { margin-top:20px; font-weight:bold; text-align:center; }
</style>
</head>
<body>
<div class="container">
<h1>üìã Formulaire de candidature VCMC</h1>

<?php if($confirmation): ?>
<p class="confirm"><?= $confirmation ?></p>
<?php endif; ?>

<form method="POST">
<label>Nom RP</label>
<input type="text" name="nom" placeholder="Ex : John Doe" required>

<label>√Çge</label>
<input type="number" name="age" placeholder="Ex : 25" required>

<label>Discord</label>
<input type="text" name="discord" placeholder="Ex : JohnDoe#1234" required>

<label>Steam / Rockstar ID</label>
<input type="text" name="steam" placeholder="Ex : STEAM_0:1:123456" required>

<label>D√©partement</label>
<select name="departement" required>
<option value="">-- Choisir votre d√©partement --</option>
<option value="Pharmacie">Pharmacie</option>
<option value="Ambulance">Ambulance</option>
<option value="Psychologue">Psychologue</option>
<option value="Urgences">Urgences</option>
<option value="Param√©dical">Param√©dical</option>
</select>

<label>Exp√©rience RP/EMS</label>
<textarea name="experience" placeholder="Ex : 2 ans RP EMS" required></textarea>

<label>Motivations</label>
<textarea name="motivations" placeholder="Ex : Aider les joueurs en RP" required></textarea>

<label>Disponibilit√©s</label>
<input type="text" name="disponibilites" placeholder="Ex : Lundi-Vendredi" required>

<label>Plages horaires</label>
<input type="text" name="plages" placeholder="Ex : 18h-22h" required>

<!-- Sc√©narios -->
<label>Sc√©nario 1 : Accident de voiture</label>
<select name="scenario1" required>
<option value="">-- Choisir la bonne r√©ponse --</option>
<option value="Alerter les secours et s√©curiser la zone">Alerter les secours et s√©curiser la zone</option>
<option value="Ignorer l‚Äôaccident et continuer votre route">Ignorer l‚Äôaccident et continuer votre route</option>
<option value="Prendre des photos/filmer la sc√®ne">Prendre des photos/filmer la sc√®ne</option>
</select>

<label>Sc√©nario 2 : R√©animation complexe</label>
<select name="scenario2" required>
<option value="">-- Choisir la bonne r√©ponse --</option>
<option value="Commencer la r√©animation et demander de l‚Äôaide imm√©diatement">Commencer la r√©animation et demander de l‚Äôaide imm√©diatement</option>
<option value="Attendre que quelqu‚Äôun d‚Äôautre intervienne">Attendre que quelqu‚Äôun d‚Äôautre intervienne</option>
<option value="Administrer des m√©dicaments sans protocole">Administrer des m√©dicaments sans protocole</option>
</select>

<label>Sc√©nario 3 : Conflit violent</label>
<select name="scenario3" required>
<option value="">-- Choisir la bonne r√©ponse --</option>
<option value="S√©curiser la zone et appeler la police/renforts">S√©curiser la zone et appeler la police/renforts</option>
<option value="Intervenir seul sans protection">Intervenir seul sans protection</option>
<option value="Filmer la sc√®ne pour les r√©seaux sociaux">Filmer la sc√®ne pour les r√©seaux sociaux</option>
</select>

<label>Sc√©nario 4 : Patient inconscient</label>
<select name="scenario4" required>
<option value="">-- Choisir la bonne r√©ponse --</option>
<option value="V√©rifier les signes vitaux et appeler les secours">V√©rifier les signes vitaux et appeler les secours</option>
<option value="Bouger le patient sans pr√©caution">Bouger le patient sans pr√©caution</option>
<option value="Attendre que quelqu‚Äôun d‚Äôautre vienne">Attendre que quelqu‚Äôun d‚Äôautre vienne</option>
</select>

<label>Sc√©nario 5 : Allergie grave</label>
<select name="scenario5" required>
<option value="">-- Choisir la bonne r√©ponse --</option>
<option value="Administrer l‚Äôadr√©naline si prescrite et alerter les secours">Administrer l‚Äôadr√©naline si prescrite et alerter les secours</option>
<option value="Ignorer et donner seulement de l‚Äôeau">Ignorer et donner seulement de l‚Äôeau</option>
<option value="Donner un m√©dicament non prescrit">Donner un m√©dicament non prescrit</option>
</select>

<button type="submit">Envoyer ma candidature</button>
</form>
</div>
</body>
</html>
